# 중앙 처리 장치(CPU)
CPU는 컴퓨터에서 기억, 해석, 연산, 제어라는 4가지의 주요 기능을 담당하는 장치다.
프로그램의 명령어를 해석하여 데이터를 연산 및 처리함으로써 컴퓨터의 각 장치들을 제어한다.

CPU는 크게 `산술 논리 장치`, `제어장치`, `레지스터` 3가지로 구성되어 있다.

## 산술 논리 장치(Arithmetic and Logical Unit, ALU)
산술논리장치는 덧셈과 뺄셈 같은 **산술 연산**과 논리합, 논리곱, 배타적 논리합과 같은 **논리 연산**을 계산하는 디지털 회로다.

![산술논리장치](https://github.com/user-attachments/assets/c49c6bfd-4ae9-46d1-bec5-8722d9dccfcf)

산술논리장치는 논리합을 계산하는 `가산기(adder)`,
보수값을 출력하는 `보수기(complementer)`,
산술 및 논리 연산의 결과를 일시적으로 저장하는 `누산기(accumulator)`,
명령어를 수행하기 위해 필요한 데이터를 저장하는 `데이터 레지스터(data register)` 등으로 구성된다.

산술논리장치는 제어장치로부터 전달받은 제어신호를 통해 두 데이터 레지스터의 값을 연산하여 결과값을 누산기에 저장한다.
이때 연산 결과에 대한 부가 정보를 상태 레지스터에 저장한다.

상태 레지스터의 구조는 CPU마다 다를 수 있으며, 상태 레지스터에 저장되는 플래그의 종류는 다음과 같다.

**상태 레지스터 플래그**<br>
- `S, sign flag 부호 플래그`: 연산 결과가 음수일 경우 참이 된다.
- `Z, zero flag 제로 플래그`: 연산 결과가 0일 경우 참이 된다.
- `C, carry flag 캐리 플래그`: 연산 결과가 올림수나 빌림수가 발생하였을 경우 참이 된다.
- `O, overflow flag 오버플로우 플래그`: 부호 있는 숫자의 연산 결과가 비트 범위를 넘어섰을 때 참이 된다.
- `P, parity flag 패리티 플래그`: 연산 결과에서 1로 된 비트의 수가 짝수일 경우 참이 된다.
- `I, interrupt flag 인터럽트 플래그`: 인터럽트 가능 여부를 나타낸다. 가능할 때 참이 된다.
- `S, supervisor flag 슈퍼바이저 플래그`: 커널 모드로 실행 중인지, 사용자 모드로 실행 중인지를 나타낸다. 커널 모드일 경우 1, 사용자 모드일 경우 0이 된다.

## 제어 장치(Control Unit, CU)
제어장치는 입출력장치 간 통신 및 조율을 제어하는 제어신호를 보내고, 명령어를 해석하여 데이터의 처리 순서를 결정하는 장치이다.

![제어장치](https://github.com/user-attachments/assets/34a68cf7-f2e0-490b-ba4c-a941d4477a1c)

제어장치는 클럭, 명령어, 상태 플래그, 제어신호를 받아들이고, CPU 내부의 ALU나 레지스터 또는 CPU 외부의 제어버스로 제어신호를 내보낸다.

`클럭(clock)`이란 컴퓨터 부품을 움직이게 할 수 있는 시간 단위이다. 클럭은 1과 0이 반복되어 나타나는데, 이 반복의 기본 단위를 클럭의 `주기(period)`라고 한다.

![클럭](https://github.com/user-attachments/assets/b557db09-9aae-4396-977f-18e267795e1a)

1초 동안 반복되는 주기의 횟수는 `주파수(frequncy)`라고 하며, 단위는 `헤르츠(Hz)`를 사용한다.
인텔 코어 i5를 기준으로 기본 클럭이 2.4GHz이며, 1초에 2.4 × 10^9번의 주기가 반복됨을 의미한다.
그러므로 오버클럭을 하게 되면 주기가 증가하여 CPU의 처리 속도를 증가시킬 수 있다.

정리하면, 제어장치는 클럭에 맞추어 명령어 레지스터로부터 해석할 명령어를 가져와서 적절한 제어신호를 내보낸다.

## 레지스터(register)
레지스터는 CPU 내부의 작은 임시 저장장치이다. 프로그램 속의 **명령어**와 **데이터**는 프로그램 실행 전/후로 레지스터에 저장된다. CPU 내부에는 다양한 레지스터가 존재하며, 각기 다른 역할을 수행한다.

### 1. 프로그램 카운터(Program Counter, PC)
프로그램 카운터는 다음에 메모리에서 읽어 들일 명령어의 주소를 저장한다. 프로그램을 순차적으로 처리하기 위해 프로그램의 순서를 카운트하며, 명령어 포인터(Instruction Pointer, IP)라고도 부른다.

### 2. 명령어 레지스터(Instruction Register, IR)
명령어 레지스터는 현재 메모리에서 읽어 들인 명령어를 저장하는 레지스터이다. 제어장치는 IR에 있는 명령어를 해석하여 제어신호를 내보낸다.

### 3. 메모리 주소 레지스터(Memory Address Register, MAR)
메모리 주소 레지스터는 메모리의 주소를 저장하는 레지스터이다. CPU가 읽고자 하는 주소 값을 주소버스로 보내기 위해서는 MAR를 거쳐야 한다.

### 4. 메모리 버퍼 레지스터(Memory Buffer Register, MBR)
메모리 버퍼 레지스터는 메모리와 주고받을 값을 저장하는 레지스터이다. 메모리에 값을 쓰기 위해서는 MBR을 거쳐야 하며, 메모리의 데이터 버스를 통해 값을 전달받을 때도 MBR을 거쳐야 한다.

### 5. 누산기(Accumulator)
ALU와 직접 연결되어 있는 레지스터로, 연산 과정의 중간값이나 결과를 저장한다.

### 6. 상태 레지스터(Status Register, SR)
ALU와 직접 연결되어 있는 레지스터로, 연산 결과 또는 CPU의 상태에 대한 부가적인 정보를 저장하고 있는 레지스터이다.

### 7. 베이스 레지스터(Base Register, BR)
주소를 지정하기 위한 기준이 되는 주소를 저장한다. 변위 주소 지정 방식에서 사용된다.

### 8. 인덱스 레지스터(Index Register, IR)
베이스 레지스터를 기준으로 한 상대 주소를 저장한다. 반복 처리나 배열 데이터 접근 등에 사용된다.

### 9. 범용 레지스터(General Register, GR)
일반적인 상황에서 자유롭게 사용할 수 있는 레지스터로 데이터와 주소를 모두 저장할 수 있다.

### 10. 스택 포인터(Stack Pointer)
스택 포인터는 스택 주소 지정 방식에 사용되는 레지스터이다. 메모리 스택 영역의 최상위 주소를 저장하고 있다.


## 메모리
메모리는 현재 실행되는 프로그램의 명령어와 데이터를 저장하는 장치이다.

메모리는 `메모리 주소 레지스터(MAR)`와 `메모리 버퍼 레지스터(MBR)`로 구성되며, CPU와 데이터를 주고받기 위해 `시스템 버스(system bus)`를 사용한다.

시스템 버스는 `주소 버스(address bus)`, `데이터 버스(data bus)`, `제어 버스(control bus)`로 구성된다.

메모리는 크게 읽기 전용 비휘발성 메모리인 `ROM(Read Only Memory)`과 휘발성 메모리인 `RAM(Random Access Memory)`으로 나눌 수 있으며,
통상적으로 메모리는 RAM을 의미한다.

### RAM
RAM의 종류는 크게 DRAM과 SRAM으로 나눌 수 있다.

#### 1. DRAM(Dynamic RAM)
DRAM은 전원이 연결되어 있더라도 저장된 데이터가 동적으로 사라지는 RAM이다.
따라서 데이터의 소멸을 막기 위해서는 주기적으로 저장된 데이터를 재활성화해야 한다.

상대적으로 소비전력이 낮고 저렴하며 집적도가 높아 대용량으로 설계하기 용이하기 때문에 일반적으로 **메모리**에 사용된다.

#### 2. SRAM(Static RAM)
SRAM은 전원이 연결되어 있다면 저장된 데이터가 사라지지 않는 RAM이다.

상대적으로 소비전력이 높고 가격이 비싸며 집적도가 낮기 때문에 일반적으로 **캐시 메모리**에 사용된다.

### 캐시 메모리
캐시 메모리는 CPU와 메모리 사이에 위치한 레지스터보다 용량이 크고 메모리보다 속도가 빠른 SRAM 기반의 저장장치이다.

**CPU의 연산 속도와 메모리 접근 속도의 차이로 인한 병목 현상을 줄이기 위해 사용한다.**

캐시 메모리는 CPU 코어와의 거리에 따라 L1, L2, L3 계층으로 구성된다.
일반적으로 L1, L2 캐시는 코어 내부에, L3 캐시는 외부에 위치한다.

멀티 프로세서의 경우 코어마다 L1, L2 캐시가 있기 때문에 데이터의 일관성을 유지하기 위해 캐시 메모리를 동기화 시키는 것이 중요하다.

![캐시메모리](https://github.com/user-attachments/assets/a4b2339f-5f1c-4888-87eb-87a78cc0d6b5)

캐시 메모리의 이점을 제대로 활용하기 위해서는 CPU가 사용할 법한 데이터를 예측해서 저장해놓아야한다.

캐시 메모리는 ***참조 지역성의 원리***에 입각해서 메모리로부터 가져올 데이터를 결정한다.

> #### 참조 지역성의 원리
> - **시간 지역성**(temporal locality): CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
> - **공간 지역성**(spatial locality): CPU는 접근한 메모리 공간 근처에 접근하려는 경향이 있다.

## 보조 기억 장치
보조기억장치는 현재 실행되지 않는 프로그램이나 데이터를 저장하고 있다가 필요한 경우 RAM으로 데이터를 전달하는 장치이다.

메모리는 보조기억장치에 비해 비싸며, 전원이 꺼지면 내용을 잃어버린다는 단점이 있다.
그러므로 데이터를 영구적으로 저장하기 위해서는 보조기억장치에 데이터를 저장해야 한다.

보조기억장치에는 하드디스크와 플래시 메모리가 있다.
하드디스크는 자기적인 방식으로 데이터를 저장하는 장치이며, 플래시 메모리는 전기적으로 데이터를 읽고 쓰는 반도체 기반의 저장장치이다. (SSD)

## 입출력 장치
입출력 장치는 컴퓨터 외부에 연결되어 컴퓨터 내부와 정보를 교환할 수 있는 장치이다.
대표적인 입출력 장치로 키보드, 모니터, 마우스 등이 있다.

입력장치는 컴퓨터가 인식할 수 있는 형태로 변환시켜 메모리로 읽어 들이는 장치이고,
출력장치는 컴퓨터에서 처리된 내용을 사용자가 인식할 수 있는 형태로 바꾸어 표시하는 장치이다.

---
**Reference**<br>
- https://huimang2.github.io/etc/computer-architecture
- https://en.wikipedia.org/wiki/Status_register
