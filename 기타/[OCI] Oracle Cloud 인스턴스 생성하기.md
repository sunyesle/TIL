# [OCI] Oracle Cloud 인스턴스 생성하기

## 구획 생성 
앞으로 생성할 리소스들을 편하게 관리할 수 있도록, 새 구획을 먼저 생성한다.

1. **[ID & 보안 > 구획]** 메뉴 클릭
2. **컴파트먼트 생성** 버튼 클릭
3. 컴파트먼트 설정
   - **이름**: `test`
   - **설명**: `test 구획`
   - **상위 컴파트먼트**: `(루트)`
4. **컴파트먼트 생성** 버튼 클릭

## 가상 클라우드 네트워크 (VCN) 생성
인스턴스를 만들기 전에, 인스턴스가 연결될 가상 네트워크를 생성한다.

1. **[네트워킹 > 가상 클라우드 네트워크]** 메뉴 클릭
2. **작업** 버튼 클릭 → **VCN 마법사 시작** 선택
3. 접속 유형 선택
   - **접속 유형**: 인터넷 접속을 통한 VCN 생성
4. VCN 마법사 설정
   - **VCN 이름**: `vcn-test`
   - **컴파트먼트**: `test`
   - *(나머지 설정은 기본값 사용)*
5. **다음** 버튼 클릭 → **생성** 버튼 클릭

## Web 인스턴스 생성
웹 서버로 사용할 인스턴스를 생성한다.

1. **[컴퓨트 > 인스턴스]** 메뉴 클릭
2. **인스턴스 생성** 버튼 클릭
3. 인스턴스 설정
   - *(생략한 설정은 기본값 사용)*
   - **[기본정보]**
     - **이름**: `instance-web`
     - **컴파트먼트**: `test`
     - **이미지**: `Canonical Ubuntu 24.04`
     - **구성**: `VM.Standard.E2.1.Micro`
   - **[네트워킹]**
     - **기본 네트워크**: `기존 가상 클라우드 네트워크 선택`
       - **가상 클라우드 네트워크 컴파트먼트**: `test`
       - **가상 클라우드 네트워크**: `vcn-test`
     - **서브넷**: `기존 서브넷 선택`
       - **서브넷 컴파트먼트**: `test`
       - **서브넷**: `퍼블릭 서브넷-vcn-test(지역별)`
     - **SSH 키 추가**: `자동으로 키 쌍 생성`
       - **프라이빗 키 다운로드**, **퍼블릭 키 다운로드** 버튼 클릭
       - 이 키 파일과 SSH를 이용하여 클라우드에 접속한다. 키 파일은 이 화면에서만 내려받을 수 있기 때문에, 키를 미리 백업해 두는 것이 좋다.
4. **다음** 버튼 클릭 → **생성** 버튼 클릭

## Web 인스턴스 보안 정책 설정 변경
HTTP/HTTPS 접속이 가능하도록 수신 규칙을 추가한다.

1. `instance-web` 인스턴스의 세부정보 페이지로 이동
2. **네트워킹** 탭 선택 → 서브넷 클릭: **퍼블릭 서브넷-vcn-test**
3. **보안** 탭 선택 → 보안 목록 클릭: **Default Security List for vcn-test**
4. **보안 규칙** 탭 선택 → **수신 규칙 추가** 버튼 클릭

- **수신 규칙 1**
  - **Stateless**: 아니오
  - **소스 유형**: CIDR
  - **소스 CIDR**: 0.0.0.0/0
  - **IP 프로토콜**: TCP
  - **소스 포트 범위**: (빈값) 
  - **대상 포트 범위**: 80
  - **설명**: HTTP
- **수신 규칙 2**
  - **Stateless**: 아니오
  - **소스 유형**: CIDR
  - **소스 CIDR**: 0.0.0.0/0
  - **IP 프로토콜**: TCP
  - **소스 포트 범위**: (빈값) 
  - **대상 포트 범위**: 443
  - **설명**: HTTP

## DB 인스턴스 생성
DB 서버로 사용할 인스턴스를 생성한다. 서브넷 설정을 제외하고는 웹 서버와 동일하다.

1. **[컴퓨트 > 인스턴스]** 메뉴 클릭
2. **인스턴스 생성** 버튼 클릭
3. 인스턴스 설정
   - *(생략한 설정은 기본값 사용)*
   - **[기본정보]**
     - **이름**: `instance-db`
     - **컴파트먼트**: `test`
     - **이미지**: `Canonical Ubuntu 24.04`
     - **구성**: `VM.Standard.E2.1.Micro`
   - **[네트워킹]**
     - **기본 네트워크**: `기존 가상 클라우드 네트워크 선택`
       - **가상 클라우드 네트워크 컴파트먼트**: `test`
       - **가상 클라우드 네트워크**: `vcn-test`
     - **서브넷**: `기존 서브넷 선택`
       - **서브넷 컴파트먼트**: `test`
       - **서브넷**: `프라이빗 서브넷-vcn-test(지역별)`
     - **SSH 키 추가**: `자동으로 키 쌍 생성`
       - **프라이빗 키 다운로드**, **퍼블릭 키 다운로드** 버튼 클릭
       - 이 키 파일과 SSH를 이용하여 클라우드에 접속한다. 키 파일은 이 화면에서만 내려받을 수 있기 때문에, 키를 미리 백업해 두는 것이 좋다.
4. **다음** 버튼 클릭 → **생성** 버튼 클릭

## DB 인스턴스 보안 정책 설정 변경
웹 서버(`instance-web`)에서 DB 서버(`instance-db`)로 접속할 수 있도록 수신 규칙을 추가한다.
MySQL 연결에 사용하는 3306 포트를 허용했다.

1. `instance-db` 인스턴스의 세부정보 페이지로 이동
2. **네트워킹** 탭 선택 → 서브넷 클릭: **프라이빗 서브넷-vcn-test**
3. **보안** 탭 선택 → 보안 목록 클릭: **프라이빗 서브넷-vcn-test의 보안 목록**
4. **보안 규칙** 탭 선택 → **수신 규칙 추가** 버튼 클릭

- **수신 규칙 1**
  - **Stateless**: 아니오
  - **소스 유형**: CIDR
  - **소스 CIDR**: `(instance-web의 프라이빗 IP)`/0
  - **IP 프로토콜**: TCP
  - **소스 포트 범위**: (빈값) 
  - **대상 포트 범위**: 3306
  - **설명**: MySQL

---
**Reference**
- https://devpanpan.tistory.com/102
- https://velog.io/@chang626/이거보면-Oracle-Cloud로-가상서버-띄울-수-있어요
- https://haksuperman.tistory.com/65
- https://sprout13.tistory.com/66
