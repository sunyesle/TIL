# 스레드 덤프 분석하기

## 스레드 덤프 생성
### PID 확인
스레드 덤프를 획득하려면 먼저 수행 중인 Java 애플리케이션 프로세스의 PID를 확인해야 한다. PID는 **jps**로 확인할 수 있다.
```
jps -v
```

### 1. jstack
**jstack**은 스레드 덤프를 출력하는 JDK 유틸리티로, JDK 1.5 버전부터 제공된다.
```
jstack [options] <pid>

예시) jstack 12512 >> thread_dump.txt
```
**옵션 목록**
- `-F`: 스레드 덤프를 강제로 실행합니다. jstack pid가 응답하지 않을 때(프로세스가 중단된 경우) 사용하면 편리하다.
- `-l`: `java.util.concurrent` Lock 정보를 함께 출력한다.
- `-m`: Java 스택 프레임 외에도 네이티브 스택 프레임(C 및 C++)을 인쇄한다.

### 2. jcmd
**jcmd**는 JVM 진단용 도구로 스레드 덤프, 힙 덤프 등 다양한 기능을 제공한다.
`jcmd <pid> help`로 사용할 수 있는 명령을 확인할 수 있다.

JDK 1.8 버전부터 제공되며, 성능 오버헤드 감소를 위해서 jstack 유틸리티 대신 jcmd 사용이 권장된다.
```
jcmd <pid> Thread.print [options] >> thread_dump.txt

예시) jcmd 12512 Thread.print >> thread_dump.txt
```
**옵션 목록** (`jcmd <pid> help Thread.print`로 확인 가능)
- `-l`: `java.util.concurrent` Lock 정보를 함께 출력한다.
- `-e`: 스레드에 대해 더 자세한 정보를 출력한다.

## 스레드 덤프 정보
스레드 덤프에는 다음과 같은 정보가 들어 있다.

<img width="698" height="313" alt="Image" src="https://github.com/user-attachments/assets/db0ad5aa-be8e-4a78-8e3c-036d55e888dd" />

---
**Reference**
- https://docs.oracle.com/en/java/javase/21/troubleshoot/diagnostic-tools.html
- https://d2.naver.com/helloworld/10963
- https://steady-coding.tistory.com/597
- https://www.baeldung.com/java-thread-dump
