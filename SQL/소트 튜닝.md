# 소트 튜닝
## Union vs Union All
Union을 사용하면 옵티마이저는 두 집합 간의 중복을 제거하기 위해 소트 연산을 수행한다.
**가능하면 Union All을 사용**해야 한다.

**예시1**<br>
<img width="301" height="111" alt="Image" src="https://github.com/user-attachments/assets/e86cf0b1-09df-4f97-b943-f82ababca83b" />

두 집합이 상호배타적인 경우 Union 대신 Union All을 사용해도 된다.
```sql
select 결제번호, 주문번호, 결제금액, 주문일자
from 결제
where 결제수단코드 = 'M' and 결제일자 = '20180316'
union all
select 결제번호, 주문번호, 결제금액, 주문일자
from 결제
where 결제수단코드 = 'C' and 결제일자 = '20180316'
```

**예시2**<br>
<img width="401" height="131" alt="Image" src="https://github.com/user-attachments/assets/e5de24d3-9cc7-4003-ba35-0916213390a4" />

소트 연산이 일어나지 않도록 Union All을 사용하면서도 데이터 중복을 피하려면 다음과 같이 하면 된다.
```sql
select 결제번호, 주문번호, 결제금액, 주문일자
from 결제
where 결제일자 = '20180316'
union all
select 결제번호, 주문번호, 결제금액, 주문일자
from 결제
where 주문일자 = '20180316'
and   결제일자 != '20180316'
```

결제일자가 Null 허용 컬럼이면 맨 아래 조건절을 다음과 같이 변경해야 한다.
```sql
and (결제일자 != '20180316' or 결제일자 is null)
```
또는
```sql
and LNNVL(결제일자 = '20180316')
```

---
**Reference**
- 친절한 SQL 튜닝 5장
