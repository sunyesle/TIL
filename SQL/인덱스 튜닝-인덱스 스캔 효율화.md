# 인덱스 스캔 효율화

## 인덱스 구조
![인덱스 구조](https://github.com/user-attachments/assets/00de242f-133f-4d05-869c-f4d232664630)

- 모든 노드는 **LMC**(Leftmost Child)를 갖는다. **루트와 브랜치 노드**의 경우 해당 노드의 가장 **왼쪽 자식노드를 가리키는 포인터** 역할을 하고, **리프 노드**의 경우 데이터를 갖는다.
- 리프 블록에 저장된 각 레코드는 키값 순으로 정렬되어 있으며, 테이블 레코드를 가리키는 **ROWID**를 갖는다.
- 리프 블록은 **양방향 연결 리스트 구조**로 앞뒤 블록에 대한 주소 값을 갖는다.

## 인덱스 탐색
### 수직적 탐색
정렬된 인덱스 레코드 중 조건을 만족하는 첫 번째 레코드를 찾는다.
**인덱스 스캔 시작 지점을 찾는 과정**이다.

### 수평적 탐색
스캔 시작점부터 찾고자 하는 데이터가 더 나타나지 않을 때까지 인덱스 리프 블록을 수평적으로 스캔한다.
인덱스에서 본격적으로 **데이터를 찾는 과정**이다.

## 액세스 조건과 필터 조건
![액세스조건과 필터조건](https://github.com/user-attachments/assets/1abc4d34-4a7e-40cb-97dc-f840113cea66)

### 인덱스 액세스 조건
**인덱스 스캔 범위를 결정하는 조건절**이다.
수직적 탐색을 통해 스캔 시작점을 결정하는 데 영향을 미치고, 인덱스 리프 블록을 스캔하다가 어디서 멈출지를 결정하는 데 영향을 미치는 조건절이다.

### 인덱스 필터 조건
**테이블로 액세스할지를 결정하는 조건절**이다.

선행 컬럼이 모두 '`=`' 조건인 상태에서 첫 번째로 나타나는 범위 검색 조건까지가 인덱스 엑세스 조건이고, 나머지는 필터 조건이다.

> **선두 컬럼과 선행 컬럼**<br>
> **선두 컬럼**은 인덱스 구성상 **맨 앞쪽**에 있는 컬럼을 지칭할 때 사용한다.<br>
> **선행 컬럼**은 어떤 컬럼보다 **상대적으로 앞쪽**에 놓은 컬럼을 지칭할 때 사용한다.
<br>

> **옵티마이저의 비용 계산 원리**<br>
> 인덱스 수직적 탐색 비용 + 인덱스 수평적 탐색 비용 + 테이블 랜럼 액세스 비용<br>
> =<br>
> 인덱스 루트와 브랜치 레벨에서 읽는 블록 수 +<br>
> 인덱스 리프 블록을 스캔하는 과정에서 읽는 블록 수 +<br>
> 테이블 액세스 과정에서 읽는 블록 수

---
**Reference**<br>
- 친절한 SQL 튜닝 3장
